<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Календарь: неделя • месяц • год</title>
  <style>
    :root{
      /* JS-фоллбэк: 1% видимой высоты окна */
      --vh: 1vh;
      /* Точный viewport width в px для масштабирования логической ширины (если нужно) */
      --vwpx: 100vw;
      /* Базовая ширина для масштабирования контента на очень узких экранах */
      --base-width: 420; /* портретная «логическая» ширина */
      --bg: #0b0c0f;
      --panel: #131722;
      --panel-2: #0f1117;
      --txt: #e6e9ef;
      --muted: #a5adba;
      --accent: #4f8cff;
      --accent-2: #7aa2ff;
      --stroke: #1f2430;
      --radius: 14px;
      --btn-h: 44px;
    }

    html, body{
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--txt);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    /* Вся страница — на весь видимый экран */
    .page{
      height: 100dvh;              /* динамическая высота */
      height: calc(var(--vh) * 100); /* устойчивый фоллбэк для моб. браузеров */
      width: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
      padding:
        env(safe-area-inset-top, 0px)
        env(safe-area-inset-right, 0px)
        env(safe-area-inset-bottom, 0px)
        env(safe-area-inset-left, 0px);
      box-sizing: border-box;
      gap: 10px;
      background: var(--panel-2);
      overflow: hidden;
    }

    /* Верхняя панель с переключателями */
    .topbar{
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: var(--panel);
      border-bottom: 1px solid var(--stroke);
    }

    .brand{
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }
    .brand .dot{
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: radial-gradient(65% 65% at 50% 50%, var(--accent) 0%, var(--accent-2) 100%);
      box-shadow: 0 0 20px rgba(79,140,255,0.4);
      flex: 0 0 auto;
    }
    .brand .title{
      font-weight: 600;
      letter-spacing: 0.2px;
      color: var(--txt);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .view-switch{
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--stroke);
      border-radius: calc(var(--btn-h) / 2);
      display: grid;
      grid-auto-flow: column;
      align-items: center;
      gap: 4px;
      padding: 4px;
      height: var(--btn-h);
    }
    .view-switch button{
      appearance: none;
      height: 36px;
      padding: 0 14px;
      border-radius: 18px;
      border: 0;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.2px;
      transition: color .2s ease, background-color .2s ease;
      outline: none;
      white-space: nowrap;
    }
    .view-switch button[aria-pressed="true"]{
      background: linear-gradient(180deg, rgba(79,140,255,0.18) 0%, rgba(79,140,255,0.14) 100%);
      color: var(--txt);
      box-shadow: inset 0 0 0 1px rgba(79,140,255,0.35);
    }
    .view-switch button:active{
      transform: translateY(1px);
    }

    /* Область календаря — растягивается */
    .calendar-wrap{
      position: relative;
      min-height: 0; /* важно для grid child with overflow */
      height: 100%;
      width: 100%;
      background: var(--panel-2);
      border-top: 1px solid var(--stroke);
      border-bottom: 1px solid var(--stroke);
      overflow: hidden;
    }
    .calendar-iframe{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      background: #fff;
      overflow: hidden;
      overscroll-behavior: contain;
    }

    /* Нижняя строка статуса/подсказки */
    .statusbar{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px;
      background: var(--panel);
      border-top: 1px solid var(--stroke);
      color: var(--muted);
      font-size: 13px;
      line-height: 1.3;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Портрет — дефолт */
    @media (orientation: portrait){
      .page{
        height: 100dvh;
        height: calc(var(--vh) * 100);
      }
    }

    /* Небольшая типографика для очень узких экранов */
    @media (max-width: 360px){
      .view-switch button{
        padding: 0 10px;
        height: 34px;
      }
    }
  </style>
  <script>
    // Устойчивые единицы высоты на мобильных: обновляем --vh и --vwpx
    (function(){
      function setViewportVars(){
        var vh = window.innerHeight * 0.01;
        var vw = window.innerWidth;
        var root = document.documentElement;
        root.style.setProperty('--vh', vh + 'px');
        root.style.setProperty('--vwpx', vw);
      }
      setViewportVars();
      window.addEventListener('resize', setViewportVars, { passive: true });
      window.addEventListener('orientationchange', setViewportVars, { passive: true });
    })();

    // Конфигурация источника Яндекс.Календаря:
    const YA_BASE = 'https://calendar.yandex.ru/embed';
    // Из запроса: private_token и tz_id нужно сохранить во всех режимах
    const YA_TOKEN = '60dc2986fd011ad112334068ba1429c715c3c6df';
    const YA_TZ = 'Europe/Moscow';

    // Соответствие наших режимов именам путей виджета:
    // В iFrame-embed у Яндекса доступны режимы /week, /month, /year для разных представлений.
    // Ссылку формируем как: https://calendar.yandex.ru/embed/<view>?private_token=...&tz_id=...
    // Источник: «Календарь на вашем сайте» — виджет календаря поддерживает выбор вида и параметры через URL. [web:31]
    function buildSrc(view){
      // защита от неожиданных значений
      const v = (view === 'week' || view === 'month' || view === 'year') ? view : 'month';
      return `${YA_BASE}/${v}?private_token=${encodeURIComponent(YA_TOKEN)}&tz_id=${encodeURIComponent(YA_TZ)}`;
    }

    // Инициализация переключателей
    document.addEventListener('DOMContentLoaded', function(){
      const iframe = document.getElementById('yc-frame');
      const buttons = Array.from(document.querySelectorAll('[data-view]'));
      let current = 'month';

      function setView(v){
        if(v === current) return;
        current = v;
        // Обновляем src iframe на соответствующий режим
        iframe.src = buildSrc(v);
        // Обновляем aria-pressed для кнопок
        buttons.forEach(b => b.setAttribute('aria-pressed', String(b.dataset.view === v)));
        // Лёгкий визуальный «селектор»
        const status = document.getElementById('status');
        status.textContent = v === 'week' ? 'Режим: Неделя'
                           : v === 'year' ? 'Режим: Год'
                           : 'Режим: Месяц';
      }

      // Начальная загрузка — месяц
      iframe.src = buildSrc(current);
      buttons.forEach(b=>{
        b.addEventListener('click', ()=>{
          setView(b.dataset.view);
        }, { passive: true });
      });
      // Установим aria-pressed исходно
      buttons.forEach(b => b.setAttribute('aria-pressed', String(b.dataset.view === current)));
    });
  </script>
</head>
<body>
  <div class="page" role="application" aria-label="Календарь: неделя — месяц — год">
    <header class="topbar">
      <div class="brand" aria-label="Заголовок">
        <div class="dot" aria-hidden="true"></div>
        <div class="title">Календарь: неделя • месяц • год</div>
      </div>
      <nav class="view-switch" role="tablist" aria-label="Переключение вида">
        <button type="button" role="tab" data-view="week" aria-pressed="false" aria-label="Неделя">Неделя</button>
        <button type="button" role="tab" data-view="month" aria-pressed="true" aria-label="Месяц">Месяц</button>
        <button type="button" role="tab" data-view="year" aria-pressed="false" aria-label="Год">Год</button>
      </nav>
    </header>

    <main class="calendar-wrap">
      <iframe
        id="yc-frame"
        class="calendar-iframe"
        title="Яндекс.Календарь — переключаемые режимы неделя/месяц/год"
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        allowtransparency="true"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
      ></iframe>
    </main>

    <footer class="statusbar">
      <div id="status">Режим: Месяц</div>
      <div aria-hidden="true">TZ: Europe/Moscow</div>
    </footer>
  </div>
</body>
</html>
